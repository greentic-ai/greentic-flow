---
id: PR-05
title: Docs + end-to-end examples + CI guardrails
date: 2026-02-05
repo: greentic-flow
track: docs-ci
depends_on: [PR-01, PR-02, PR-03, PR-04]
---

# PR-05: Docs + E2E examples + CI guardrails

## Goal
Make the new wizard workflow discoverable and keep it from drifting.

## Changes
1) Documentation
- Add `docs/component_wizard.md` explaining:
  - template generation
  - ABI versioning + wasm naming
  - QA modes default/setup/upgrade/remove
  - doctor validation
  - flow integration via greentic-flow + distribution client
- Add quickstart commands.

2) End-to-end example
- Provide a small example component template committed under `examples/` (or generated during tests) showing:
  - describe + qa-spec + apply-answers + run stubs
  - example answers and schema

3) CI checks (lightweight)
- Validate that:
  - greentic-component wizard new runs in CI (smoke)
  - doctor passes on the generated template
  - greentic-flow add-step can run in a mocked mode (no network)
- Add a guardrail: deprecated WIT packages should not change without an explicit allowlist (if applicable).

## Acceptance criteria
- New docs explain the workflow clearly.
- CI includes at least one smoke test that exercises wizard+doctor.

## Decisions / answers (2026-02-10)
1) E2E example location
- Do both:
  - Commit a small static example under `examples/` for human reference.
  - CI generates a fresh example via the wizard and runs doctor on it (prevents rot).

2) “Mocked mode (no network)” for greentic-flow add-step
- Introduce a stub distribution client behind a trait.
- Shape:
  - `DistributionResolver` trait
  - Real impl: greentic-distribution-client
  - Test impl: reads from `tests/fixtures/registry/` mapping `component_id` → wasm bytes + metadata + canned outputs (or a tiny mock wasm)
- CI runs `greentic-flow add-step` with `--resolver fixture://tests/fixtures/registry` (or env var), ensuring zero network calls.

3) Allowlist format/location for deprecated WIT guardrails
- Repo-local allowlist, explicit and reviewable.
- Suggested file: `wit/deprecated_allowlist.toml` or `tools/wit_deprecated_allowlist.json`
- Format: list of package IDs plus metadata.
  - `package: "greentic:tenant-ctx@0.4.0"`
  - `allowed_by: "PR-XX"`
  - `reason: "Legacy adapter until 0.6 migration complete"`
  - `expires`: optional date

4) CI ownership across repos
- Each repo validates its own contract:
  - greentic-component: wizard + template + doctor on generated project
  - greentic-flow: add/update/remove with fixture resolver
  - greentic-types/interfaces: WIT guardrails + linting
- Optional integration repo runs a pinned end-to-end smoke for cross-repo compatibility.
